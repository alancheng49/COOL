/* ========== Base ========== */
* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  font-family: 'Microsoft JhengHei', '微軟正黑體', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background-color: #f0f2f5;
  margin: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}

.container {
  background: #fff;
  width: 92%;
  max-width: 980px;
  padding: 24px;
  border-radius: 12px;
  box-shadow: 0 6px 18px rgba(0,0,0,.08);
}

h1, h2, h3 { color: #333; margin: 0 0 12px; text-align: center; }

/* ========== Forms / Buttons ========== */
#login-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

input[type="text"],
input[type="password"]{
  width: 100%;
  padding: 12px 14px;
  border: 1px solid #cfcfcf;
  border-radius: 8px;
  font-size: 16px;
  background: #fff;
  outline: none;
}

button {
  padding: 12px 16px;
  border: 0;
  border-radius: 8px;
  background: #1976d2;
  color: #fff;
  font-size: 16px;
  cursor: pointer;
  transition: background .2s ease, opacity .2s ease;
}
button:hover { background: #125ea7; }
button:disabled { opacity:.6; cursor:not-allowed; }
button.secondary { background: #6b7280; }
button.secondary:hover { background: #555c69; }
button.danger { background: #d32f2f; }
button.danger:hover { background: #b22525; }

.error-message {
  color: #d32f2f;
  min-height: 20px;   /* 確保未出現時不跳動 */
  text-align: center;
}

/* 小工具 */
.row { display: flex; align-items: center; }
.gap8 { gap: 8px; }
.spacer { flex: 1; }
.hidden { display: none !important; }

/* 左上角版本號 */
#build-version{
  position: fixed;
  top: 8px;
  left: 10px;
  font-size: 10pt;
  color: #888;
  z-index: 9999;
  user-select: none;
  pointer-events: none;
  opacity: .95;
}

/* ========== Quiz Layout (Grid 版) ========== */
#quiz-layout{
  display: grid;
  grid-template-columns: 1fr 280px; /* 主面板 + 側欄 */
  gap: 18px;
}

/* 主面板 */
#question-panel{
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* 題幹：文字 + 圖片 70/30 排版 */
.q-row { display: flex; align-items: flex-start; gap: 16px; }
.q-text { flex: 7 1 0; min-width: 0; }
.q-media { flex: 3 1 0; max-width: 30%; }
.q-media img { width: 100%; height: auto; display: block; border-radius: 6px; }

/* 純文字題幹 */
#question-content h2 { text-align: left; }
#question-content img { max-width: 100%; height: auto; display: block; }

/* 選項 */
#options-container{
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.option{
  padding: 12px 14px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  background: #fff;
  cursor: pointer;
  transition: background .15s ease, border-color .15s ease, box-shadow .15s ease;
}
.option:hover { background: #f7fbff; }
.option.selected{
  background: #e7f2ff;
  border-color: #1976d2;
  box-shadow: 0 0 0 2px rgba(25,118,210,.12) inset;
}

/* 主面板下方導覽列 */
.nav-row{
  display: flex;
  align-items: center;
  gap: 10px;
}

/* 側欄 */
#sidebar{
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.side-head{
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
  align-items: center;
}
.side-head h3{
  margin: 0;
  text-align: left;
}

/* 題號清單 */
#question-list{
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 8px;
}
#question-list .q-item{
  width: 100%;
  text-align: left;
  padding: 10px 12px;
  background: #f3f4f6;
  color: #374151;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  cursor: pointer;
  transition: background .15s ease, border-color .15s ease;
}
#question-list .q-item:hover{ background: #eef2f7; }
#question-list .q-item.current{
  background: #e7f2ff;
  border-color: #1976d2;
}
#question-list .q-item.answered{
  position: relative;
  border-color: #34a853;
  background: #e9f7ef;
}
#question-list .q-item.answered::after{
  content: "✓";
  position: absolute;
  right: 10px;
  top: 8px;
  color: #2e7d32;
  font-weight: 700;
}

/* 計時器（與 JS 對齊） */
.timer{
  justify-self: end;
  font-size: 12px;
  color: #666;
  padding: 6px 10px;
  border: 1px solid #e5e7eb;
  border-radius: 999px;
  background: #fafafa;
  display: inline-flex;  /* JS 會控制顯示/隱藏 */
  align-items: center;
  gap: 6px;
}
.timer.danger{ color: #c0392b; border-color: #f2c6c6; background: #fff6f6; }

/* 結果頁 */
#score{
  text-align: center;
  font-size: 22px;
  font-weight: 700;
  color: #2e7d32;
}
#wrong-answers-list{
  list-style: none;
  margin: 16px 0 0;
  padding: 0;
  display: grid;
  gap: 10px;
}
#wrong-answers-list li{
  background: #fff7f7;
  border-left: 5px solid #dc3545;
  padding: 12px;
  border-radius: 6px;
}

/* ========== Cloze（唯一保留版本，與 JS 對齊） ========== */
.cloze-wrap{
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.cloze-slot{
  border: 1px dashed #cbd5e1;
  border-radius: 6px;
  padding: 8px 10px;
  background: #f8fafc;
  font-size: 14px;
}
.cloze-slot b{ color: #0f172a; }
.cloze-grid{
  display: grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap: 8px;
  margin-top: 8px;
}
.cloze-btn{
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  background: #fff;
  cursor: pointer;
  transition: background .15s ease, border-color .15s ease, transform .05s ease;
}
.cloze-btn:hover{ background: #f7fbff; }
.cloze-btn.selected{
  background: #e7f2ff;
  border-color: #1976d2;
}

/* --- Cloze: 將新版 quiz-ui.js 的類名對應到現有樣式 --- */
.cloze-blank {        /* 等同 .cloze-slot */
  border: 1px dashed #cbd5e1;
  border-radius: 6px;
  padding: 8px 10px;
  background: #f8fafc;
  font-size: 14px;
}
.cloze-blank .label { font-weight: 600; color: #0f172a; margin-bottom: 6px; }

.cloze-options {      /* 等同 .cloze-grid */
  display: grid;
  grid-template-columns: repeat(4, minmax(0,1fr));
  gap: 8px;
  margin-top: 8px;
}

.cloze-option {       /* 等同 .cloze-btn */
  padding: 8px 10px;
  border-radius: 8px;
  border: 1px solid #e5e7eb;
  background: #fff;
  cursor: pointer;
  transition: background .15s ease, border-color .15s ease, transform .05s ease;
}
.cloze-option:hover   { background: #f7fbff; }
.cloze-option.selected{
  background: #e7f2ff;
  border-color: #1976d2;
}

/* ========== Mobile ========== */
@media (max-width: 768px){
  .container { width: 96%; padding: 18px; }

  /* 排版改單欄，側欄到下方 */
  #quiz-layout{
    grid-template-columns: 1fr;
    gap: 14px;
  }
  #sidebar { order: 2; }

  /* 禁止整頁/容器的水平滾動（避免「左右滑」體感） */
  html, body,
  .container,
  #quiz-layout,
  #question-panel,
  #question-content{
    overflow-x: hidden !important;
  }

  /* 題幹直排 */
  .q-row{ flex-direction: column; }
  .q-media{ max-width: 100%; }

  /* ✅ 取消整個主面板的捲動：選項不在捲動容器內 */
  #question-panel{
    max-height: none !important;
    overflow: visible !important;
  }

  /* ✅ 只讓題幹可捲動；保留空間給選項與底部導覽列 */
  /* 這裡用 100dvh 扣掉導覽列和間距，避免被遮住 */
  #question-content{
    max-height: calc(100dvh - 220px);
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }

  /* 底部 sticky 導覽（保證行動版繳交鈕可見） */
  .nav-row{
    position: sticky;
    bottom: 0;
    background: #fff;
    padding: 10px;
    margin: 0 -10px -10px;         /* 撐滿容器 */
    border-top: 1px solid #e5e7eb;
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 8px;
  }

  /* 行動版專用繳交 */
  #submit-btn-mobile{ display: inline-flex; }
}

/* 結果頁骨架：上、下固定，中間滾動 */
#results-container{
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* 讓標題/分數固定在頂端 */
.results-head{
  position: sticky;
  top: 0;
  z-index: 10;
  background: #fff;
  padding: 16px 18px 12px;
  border-bottom: 1px solid #eee;
}

/* 錯題清單所在的可捲動區域：
   100dvh 可避免 iOS Safari 位址列高度變化問題 */
.results-body{
  overflow: auto;
  /* 扣掉頭尾的高度：自行微調 180~220px 之間最合適 */
  max-height: calc(100dvh - 200px);
  padding: 8px 0 12px;
}

/* 底部按鈕列固定在底部 */
.results-actions{
  position: sticky;
  bottom: 0;
  z-index: 9;
  background: #fff;
  padding: 12px 18px;
  border-top: 1px solid #eee;
}

/* 讓錯題項目之間有間距 */
#wrong-answers-list{
  list-style: none;
  margin: 0;
  padding: 0 18px 12px;
  display: grid;
  gap: 12px;
}

/* 你原本的錯題卡片樣式可保留；示意： */
#wrong-answers-list li{
  background: #fff3f3;
  border-left: 5px solid #dc3545;
  padding: 12px;
  border-radius: 8px;
}

/* ====== History (兩欄版面) ====== */

/* 容器寬度可視網站基準微調 */
.history-container { max-width: 1200px; }

/* 頁首固定在可視範圍上方，方便切換 Tab 與返回 */
.history-head {
  position: sticky;
  top: 8px;
  z-index: 5;
  background: #fff;
  padding-top: 4px;
  margin-bottom: 12px;
}
.history-head h1 { margin: 0 0 8px; line-height: 1.2; }
.head-actions { align-items: center; }

/* 主體為左右兩欄：左清單 300px，右詳細自動填滿 */
.history-body {
  display: grid;
  grid-template-columns: 300px 1px minmax(0, 1fr); /* 左 300px｜中間 1px 分隔｜右自動 */
  gap: 16px;
  align-items: start;
}

/* 左欄：清單可捲動，高度扣掉 header 約略值（依站上其他區塊調整） */
.history-list {
  height: calc(100dvh - 170px);
  overflow: auto;
  padding-right: 4px;
  display: grid;
  gap: 8px;

  align-content: start;
}

/* 清單每列（沿用你原有 row/card 風格） */
.hist-row {
  cursor: pointer;
  align-items: center;
}
.hist-row:hover { box-shadow: 0 4px 14px rgba(0,0,0,.06); }
.hist-row .secondary { white-space: nowrap; }
/* 左列卡片三行樣式 */
.hist-cell { display: grid; align-content: start; gap: 6px; }
.hist-title { font-weight: 700; color: #111827; }
.hist-meta  { color: #6b7280; font-size: 13px; display: flex; gap: 10px; }
.hist-meta .hist-score { font-weight: 600; color: #111827; }

/* 中間細分隔線（桌面版顯示） */
.history-vrule {
  width: 1px;
  background: rgba(0,0,0,.08);
  height: calc(100% - 4px);
  align-self: stretch;
  border-radius: 1px;
}

/* 右欄：詳細內容區（與 quiz 結果頁一致可長捲） */
.history-detail {
  min-height: calc(100dvh - 170px);
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 6px 22px rgba(0,0,0,.08);
  padding: 16px 18px;
  overflow: auto;
}

/* 空狀態（尚未選擇清單） */
.empty-state {
  display: grid;
  align-content: start;
  gap: 6px;
  color: #666;
}
.empty-title {
  font-size: 20px;
  font-weight: 700;
  color: #333;
}
.empty-desc { margin: 0; }

/* 右欄內部「錯題分析」列表的視覺（沿用你結果頁語感） */
#wrong-answers-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: grid;
  gap: 14px;
}
#wrong-answers-list li {
  background: #fff3f3;
  border-left: 5px solid #dc3545;
  padding: 12px;
  border-radius: 6px;
}

/* RWD：寬度小於 900px 時改為單欄（清單在上、詳情在下） */
@media (max-width: 900px) {
  .history-body {
    grid-template-columns: 1fr;
    gap: 12px;
  }
  .history-vrule { display: none; }
  .history-list, .history-detail {
    height: auto;
    min-height: 0;
  }
}

/* 預設：行動版繳交隱藏，手機媒體查詢會打開 */
#submit-btn-mobile{ display: none; }

/* 登入按鈕 busy 樣式（雙保險） */
#login-btn.is-busy{ pointer-events: none; }

/* ========== Scrollable Page Layout ========== */
/* 關閉全站預設的置中，讓頁面可自然直向捲動 */
body.page--scroll{
  align-items: flex-start;
  justify-content: center;
}

.page--scroll .container{
  margin: 24px auto;
}

/* 題幹太長時，讓內容能換行、不被擠出畫面 */
#question-content, #options-container, .q-text {
  overflow-wrap: anywhere;   /* 公式或長字串也能折行 */
  word-break: break-word;
}

/* 桌機也可能遇到小解析度，給主面板一個最小高度與彈性 */
#question-panel { min-height: 0; }

/* 手機與小螢幕：主面板獨立可捲動，底部導覽列 sticky 不會遮住內容 */
@media (max-width: 768px){
  /* 估算：把 sticky 導覽列（約 56~72px）與上下內距扣掉，避免被吃掉 */
  #question-panel{
    max-height: calc(100dvh - 140px);
    overflow: auto;                 /* 題幹、選項過長時可在此容器內捲動 */
    -webkit-overflow-scrolling: touch;  /* iOS 慣性捲動 */
  }
}

/* 圖片安全縮放（你已有設定，這裡再補強一次以避免外層樣式覆蓋） */
#question-content img, .q-media img{
  max-width: 100%;
  height: auto;
  display: block;
}

/* === Help (如何使用) 按鈕 + 懸浮視窗 === */
.help-btn{
  position: fixed;
  top: 12px;
  right: 12px;
  z-index: 10000;
  padding: 6px 10px;
  font-size: 12px;
  border-radius: 999px;
  border: 1px solid #e5e7eb;
  background: #f3f4f6;
  color: #374151;
  cursor: pointer;
}
.help-btn:hover{ background:#eef2f7; }

.help-modal-backdrop{
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.35);
  z-index: 10001;
  display: none;
}
.help-modal{
  position: fixed;
  top: 6vh;
  left: 50%;
  transform: translateX(-50%);
  width: min(920px, 92vw);
  max-height: 88vh;
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 10px 30px rgba(0,0,0,.2);
  z-index: 10002;
  display: none;
  overflow: hidden;
}
.help-modal.show, .help-modal-backdrop.show{ display:block; }

.help-head{
  display:flex; align-items:center; gap:10px;
  border-bottom:1px solid #eee;
  padding:12px 14px;
}
.help-head h3{ margin:0; font-size:16px; text-align:left; }
.help-close{ margin-left:auto; background:#6b7280; }
.help-close:hover{ background:#555c69; }

.help-body{
  padding:14px 16px;
  overflow:auto;
  max-height: calc(88vh - 56px);
}

/* 讓 md 內容易讀 */
.help-body h1, .help-body h2, .help-body h3{ text-align:left; }
.help-body pre{ background:#f8fafc; padding:10px; border-radius:8px; overflow:auto; }
.help-body code{ background:#f3f4f6; padding:2px 4px; border-radius:4px; }
.help-body ul{ padding-left: 1.2rem; }